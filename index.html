<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comentarios Anónimos</title>
<style>
  /* Estilos básicos para el formulario y los comentarios */
  .comment-section {
    width: 80%;
    margin: auto;
    margin-top: 20px;
    border: 1px solid #ccc;
    padding: 10px;
  }
  .comment {
    position: relative;
    margin-bottom: 10px;
    padding: 10px;
    border: 1px solid #eee;
  }
  .comment .delete-btn {
    position: absolute;
    top: 5px;
    right: 5px;
    cursor: pointer;
    color: red;
  }
  .hidden {
    display: none;
  }
</style>
</head>
<body>
  <div class="comment-section">
    <h2>Deja tu comentario</h2>
    <form id="commentForm">
      <div id="nameField" class="hidden">
        <label for="username">Tu nombre:</label>
        <input type="text" id="username" name="username">
        <br><br>
      </div>
      <label for="commentType">Selecciona el tipo de comentario:</label>
      <select id="commentType" name="commentType">
        <option value="anonimo">Anónimo</option>
        <option value="nombre">Diligenciar Nombre</option>
      </select>
      <br><br>
      <label for="comment">Comentario:</label>
      <textarea id="comment" name="comment" rows="4" cols="50"></textarea>
      <br><br>
      <button type="submit">Enviar Comentario</button>
    </form>
    <div id="commentList">
      <!-- Aquí se mostrarán los comentarios -->
    </div>
  </div>

  <script>
    // Identificador único para el usuario
    const commenterId = Date.now();

    // Función para manejar el cambio en la selección del tipo de comentario
    document.getElementById('commentType').addEventListener('change', function() {
      var selectedOption = this.value;
      var nameField = document.getElementById('nameField');

      if (selectedOption === 'nombre') {
        nameField.classList.remove('hidden');
      } else {
        nameField.classList.add('hidden');
      }
    });

    // Función para manejar el envío del formulario
    document.getElementById('commentForm').addEventListener('submit', function(event) {
      event.preventDefault(); // Prevenir el envío por defecto
      
      // Obtener valores del formulario
      var username = document.getElementById('username').value;
      var commentType = document.getElementById('commentType').value;
      var comment = document.getElementById('comment').value;

      // Crear un identificador único para el comentario (simulación)
      var commentId = Date.now();

      // Crear un objeto para almacenar el comentario
      var newComment = {
        id: commentId,
        commenterId: commenterId,
        username: username,
        comment: comment
      };

      // Obtener la lista de comentarios del almacenamiento local o inicializarla
      var comments = JSON.parse(localStorage.getItem('comments')) || [];

      // Agregar el nuevo comentario a la lista
      comments.push(newComment);

      // Guardar la lista de comentarios en el almacenamiento local
      localStorage.setItem('comments', JSON.stringify(comments));

      // Mostrar los comentarios actualizados
      showComments();
    });

    // Función para mostrar los comentarios almacenados
    function showComments() {
      var comments = JSON.parse(localStorage.getItem('comments')) || [];

      var commentListDiv = document.getElementById('commentList');
      commentListDiv.innerHTML = ''; // Limpiar la lista de comentarios antes de mostrarlos

      comments.forEach(function(comment) {
        var commentDiv = document.createElement('div');
        commentDiv.classList.add('comment');
        
        // Crear botón para eliminar comentario (solo visible para el usuario que lo escribió)
        var deleteBtn = document.createElement('span');
        deleteBtn.classList.add('delete-btn');
        deleteBtn.innerHTML = 'Eliminar';
        deleteBtn.onclick = function() {
          deleteComment(comment.id);
        };

        // Construir contenido del comentario
        var commentText = '';
        if (comment.username) {
          commentText = '<strong>' + comment.username + ':</strong> ' + comment.comment;
        } else {
          commentText = '<strong>Anónimo:</strong> ' + comment.comment;
        }
        
        // Agregar contenido del comentario al div
        commentDiv.innerHTML = commentText;

        // Agregar botón de eliminar solo si el commenterId coincide
        if (comment.commenterId === commenterId) {
          commentDiv.appendChild(deleteBtn);
        }

        // Agregar comentario al contenedor
        commentListDiv.appendChild(commentDiv);
      });
    }

    // Función para eliminar un comentario
    function deleteComment(commentId) {
      console.log('Intentando eliminar comentario con ID:', commentId);
      
      var comments = JSON.parse(localStorage.getItem('comments')) || [];
      console.log('Comentarios antes de la eliminación:', comments);

      // Filtrar comentarios y mantener solo los que no coincidan con el id del comentario a eliminar
      comments = comments.filter(function(comment) {
        return comment.id !== commentId;
      });
      
      console.log('Comentarios después de la eliminación:', comments);

      localStorage.setItem('comments', JSON.stringify(comments)); // Actualizar localStorage

      // Mostrar comentarios actualizados después de la eliminación
      showComments();
    }

    // Mostrar los comentarios almacenados al cargar la página
    showComments();
  </script>
</body>
</html>
